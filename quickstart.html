<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>3. Quick-start guide to BAMM &mdash; bamm 1.0 documentation</title>
    
    <link rel="stylesheet" href="_static/bamm.css" type="text/css" />
    <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    './',
        VERSION:     '1.0',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="_static/jquery.js"></script>
    <script type="text/javascript" src="_static/underscore.js"></script>
    <script type="text/javascript" src="_static/doctools.js"></script>
    <link rel="top" title="bamm 1.0 documentation" href="index.html" />
    <link rel="next" title="4. Setting Up BAMM" href="settingup.html" />
    <link rel="prev" title="2. BAMM graph gallery" href="bammgraph.html" /> 
  </head>
  <body>
<div class="pageheader">
    <h1>BAMM: Bayesian Analysis of Macroevolutionary Mixtures</h1>
</div>

    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="settingup.html" title="4. Setting Up BAMM"
             accesskey="N">next</a> |</li>
        <li class="right" >
          <a href="bammgraph.html" title="2. BAMM graph gallery"
             accesskey="P">previous</a> |</li>
<li><a href="index.html">Home</a>&nbsp;|</li>
<li><a href="download.html">Download</a>&nbsp;|</li>
<li><a href="documentation.html">Documentation</a></li>
 
      </ul>
    </div>
      <div class="sphinxsidebar">
        <div class="sphinxsidebarwrapper">
  <h3><a href="documentation.html">Table Of Contents</a></h3>
  <ul>
<li><a class="reference internal" href="#">3. Quick-start guide to BAMM</a><ul>
<li><a class="reference internal" href="#control-file">3.1. Control file</a></li>
<li><a class="reference internal" href="#speciation-extinction-analyses">3.2. Speciation-extinction analyses</a><ul>
<li><a class="reference internal" href="#incomplete-taxon-sampling">3.2.1. Incomplete taxon sampling</a></li>
</ul>
</li>
<li><a class="reference internal" href="#phenotypic-evolution">3.3. Phenotypic evolution</a></li>
<li><a class="reference internal" href="#bamm-output-brief">3.4. BAMM output: brief</a></li>
</ul>
</li>
</ul>

  <h4>Previous topic</h4>
  <p class="topless"><a href="bammgraph.html"
                        title="previous chapter">2. BAMM graph gallery</a></p>
  <h4>Next topic</h4>
  <p class="topless"><a href="settingup.html"
                        title="next chapter">4. Setting Up BAMM</a></p>
  <h3>This Page</h3>
  <ul class="this-page-menu">
    <li><a href="_sources/quickstart.txt"
           rel="nofollow">Show Source</a></li>
  </ul>
<div id="searchbox" style="display: none">
  <h3>Quick search</h3>
    <form class="search" action="search.html" method="get">
      <input type="text" name="q" />
      <input type="submit" value="Go" />
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
    <p class="searchtip" style="font-size: 90%">
    Enter search terms or a module, class or function name.
    </p>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body">
            
  <div class="section" id="quick-start-guide-to-bamm">
<span id="quickstart"></span><h1>3. Quick-start guide to BAMM<a class="headerlink" href="#quick-start-guide-to-bamm" title="Permalink to this headline">¶</a></h1>
<p>This section assumes you have a compiled version of <strong>BAMM</strong> in a directory on your computer (see <a class="reference internal" href="settingup.html#bammsetup"><em>this section</em></a> for installation). This is a <strong>quick-start</strong> guide: we will provide guidance for some general parameter settings that should get BAMM running on your dataset, but you should explore the <em class="xref std std-ref">configurations and settings</em> page in more detail to optimize performance.</p>
<p>BAMM can be used to model speciation-extinction rates and phenotypic evolutionary rates across phylogenetic trees. To run a speciation-extinciont analysis on your dataset, you need the following (easiest if all in the same directory):</p>
<ul class="simple">
<li>A time-calibrated phylogenetic tree</li>
<li>A <em>control</em> file</li>
<li>The BAMM program</li>
</ul>
<p>To use BAMM to analyze phenotypic evolution, you also need a file containing your phenotypic (trait) data.</p>
<p>Your phylogenetic tree must be <strong>ultrametric</strong>, it must be <strong>fully bifurcating</strong> (no polytomies), and all branch lengths must be <strong>greater than 0</strong>. BAMM checks for these things, but it&#8217;s also good to do a quick check in R using the <em>ape</em> package. You can do this as follows:</p>
<div class="highlight-python"><pre>library(ape)
v &lt;- read.tree("myPhylogeny.tre")
is.ultrametric(v)
is.binary.tree(v)
# Now to check min branch length:
min(v$edge.length)</pre>
</div>
<p>If all of those checks are good, we can move on.</p>
<div class="section" id="control-file">
<h2>3.1. Control file<a class="headerlink" href="#control-file" title="Permalink to this headline">¶</a></h2>
<p>To run <tt class="docutils literal"><span class="pre">bamm</span></tt>, you must always specify a <em>control file</em>. The control file contains all of the settings necessary to run the program on your dataset, including the name(s) of the input files you seek to analyze. The easiest way to run BAMM is to place the control file, and all files to be analyzed (e.g., the phylogeny) in the same directory as the <strong>BAMM</strong> application. If your control file is named <tt class="docutils literal"><span class="pre">myControlFile.txt</span></tt>, you would run BAMM as follows (on the OSX operating system):</p>
<div class="highlight-python"><pre>.\bamm -control myControlFile.txt</pre>
</div>
<p>On Windows machines, you would ...</p>
<p><strong>NOT DONE</strong> %% Needs Windows explanation</p>
<p>BAMM comes with example control files (located in the directory <tt class="docutils literal"><span class="pre">examples/</span></tt> ). Use these as a template for setting up your own analyses. The control file is simply a text file with a set of parameter names, followed by the &#8220;equals&#8221; sign (=), followed by the parameter value. Anything on a line of the control file to the right of a pound sign (#) will be ignored by the program (e.g., it is considered a <em>comment</em>). Part of your control file might look like this:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="c"># This line is a comment. It will not be read by BAMM</span>
<span class="n">modeltype</span> <span class="o">=</span> <span class="n">speciationextinction</span>
<span class="n">treefile</span> <span class="o">=</span> <span class="n">myPhylogeny</span><span class="o">.</span><span class="n">tre</span>
<span class="n">runInfoFilename</span> <span class="o">=</span> <span class="n">run_info</span><span class="o">.</span><span class="n">txt</span>
<span class="c"># This line is also a comment and not read</span>
<span class="n">runMCMC</span> <span class="o">=</span> <span class="mi">1</span>
<span class="n">useGlobalSamplingProbability</span> <span class="o">=</span> <span class="mi">1</span>
<span class="n">globalSamplingFraction</span> <span class="o">=</span> <span class="mf">0.81</span>
<span class="n">seed</span> <span class="o">=</span> <span class="mi">12345</span>
<span class="n">poissonRatePrior</span> <span class="o">=</span> <span class="mf">1.0</span> <span class="c"># Another comment here</span>
</pre></div>
</div>
<p>There are many possible settings that can be tweaked in BAMM. The next two sections give you a simple recipe for running the program on your data, depending on whether you are analyzing speciation-extinction rates or phenotypic evolutionary rates. <strong>There is no guarantee that these settings will work for your dataset</strong>.</p>
</div>
<div class="section" id="speciation-extinction-analyses">
<h2>3.2. Speciation-extinction analyses<a class="headerlink" href="#speciation-extinction-analyses" title="Permalink to this headline">¶</a></h2>
<p>You must have an ultrametric phylogenetic tree. For optimal performance with the <em>quick-start</em> settings, the tree should be calibrated in units of millions of years (e.g, a branch length of 1.0 implies 1.0 million years). As a template, use the example file linked <a class="reference download internal" href="_downloads/divcontrol_template.txt"><tt class="xref download docutils literal"><span class="pre">here</span> <span class="pre">(divcontrol_template.txt)</span></tt></a>. The default values in this file work reasonably well for most trees calibrated on million-year timescales but may not work for your data. Here&#8217;s an example <a class="reference download internal" href="_downloads/whaletree.txt"><tt class="xref download docutils literal"><span class="pre">phylogenetic</span> <span class="pre">tree</span> <span class="pre">of</span> <span class="pre">whales</span></tt></a> that is used elsewhere in this documentation.</p>
<p>If you open the template file, you&#8217;ll see that there are extensive comments. For each parameter in the BAMM control file, we&#8217;ve included a brief description on the line following the parameter. For example:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="n">modeltype</span> <span class="o">=</span> <span class="n">speciationextinction</span>
<span class="c"># Specify speciationextinction or trait analysis</span>
</pre></div>
</div>
<p>This tells us what parameter <cite>modeltype</cite> does. It specifies the type of analysis (here, a speciation-extinction analysis). If we wanted to do a phenotypic evolutionary analysis, we would have set <cite>modeltype = trait</cite>.</p>
<p>There are only a handful of parameters in the template file that you need to set explicitly in order to run BAMM. These are currently defined with the following symbol: <cite>%%%%</cite>. For example, you see the following immediately after <cite>modeltype</cite>:</p>
<div class="highlight-python"><pre>treefile = %%%%
# Location of phylogenetic tree to be analyzed</pre>
</div>
<p>This is where you specify the name of your phylogenetic tree. For example, <tt class="docutils literal"><span class="pre">treefile</span> <span class="pre">=</span> <span class="pre">mytree.tre</span></tt>. The other parameters we will force you to define explicitly have to do with output. This parameter block looks like this in the template:</p>
<div class="highlight-python"><pre>numberGenerations = %%%%

mcmcWriteFreq = %%%%

eventDataWriteFreq = %%%%

printFreq = %%%%</pre>
</div>
<p><tt class="docutils literal"><span class="pre">numberGenerations</span></tt> is the number of simulation steps you want in your MCMC analysis. <tt class="docutils literal"><span class="pre">printfreq</span></tt> is the frequency that BAMM will write some simple information to the screen so you can track the progress of the run. <tt class="docutils literal"><span class="pre">mcmcWriteFreq</span></tt> and <tt class="docutils literal"><span class="pre">eventDataWriteFreq</span></tt> tells BAMM how often to write the two basic types of output to file. BAMM generates two types of output. The first is a file containing basic attributes of the MCMC chain as you sample it at particular timepoints. This includes: the log-likelihood of the data under the current parameters, the number of diversification shifts in the current state, the log-prior density of the current parameters, and a moving-window average of the acceptance rate for the MCMC simulation. The second type of output is the <em>event data</em>. This is the real stuff of interest. It all parameters associated with the macroevolutionary rate regimes and is used for all the subsequent analyses of evolutionary rates.</p>
<p>You can set these parameters to whatever you want. However, please remember that you will be working with the <em>event data file</em> in R, which is a bit limited on memory. As a rough guide, we suggest choosing a value for <tt class="docutils literal"><span class="pre">eventDataWriteFreq</span></tt> that gives at least 1000 samples from the posterior, but we also don&#8217;t see much advantage to having more than 5000.</p>
<p>That&#8217;s all you need to know. For starters, you should try a simple run with settings like this:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="n">numberGenerations</span> <span class="o">=</span> <span class="mi">5000</span>
<span class="n">mcmcWriteFreq</span> <span class="o">=</span> <span class="mi">1000</span>
<span class="n">eventDataWriteFreq</span> <span class="o">=</span> <span class="mi">1000</span>
<span class="n">printFreq</span> <span class="o">=</span> <span class="mi">100</span>
</pre></div>
</div>
<p>You&#8217;ll want to increase all of these once you are sure the program is correctly loading your data etc, but it&#8217;s a good first check.</p>
<div class="section" id="incomplete-taxon-sampling">
<h3>3.2.1. Incomplete taxon sampling<a class="headerlink" href="#incomplete-taxon-sampling" title="Permalink to this headline">¶</a></h3>
<p>For speciation-extinction analyses BAMM can analytically account for incomplete taxon sampling that might otherwise bias results. You can even correct for <em>non-random</em> taxon sampling. An explanation of how to account for both random and non-random taxon sampling is found  <a class="reference internal" href="advanced.html#incompsampling"><em>here</em></a>.</p>
</div>
</div>
<div class="section" id="phenotypic-evolution">
<span id="phenotypicquick"></span><h2>3.3. Phenotypic evolution<a class="headerlink" href="#phenotypic-evolution" title="Permalink to this headline">¶</a></h2>
<p>This section is quite redundant with the preceding section on <strong>speciation-extinction</strong>, with a few differences.</p>
<p>You must have an ultrametric phylogenetic tree. For optimal performance with the <em>quick-start</em> settings, the tree should be calibrated in units of millions of years (e.g, a branch length of 1.0 implies 1.0 million years). As a template, use the example file linked <a class="reference download internal" href="_downloads/traitcontrol_template.txt"><tt class="xref download docutils literal"><span class="pre">here</span> <span class="pre">(traitcontrol_template.txt)</span></tt></a>. The default values in this file work reasonably well for most trees calibrated on million-year timescales but may not work for your data.</p>
<p>If you open the template file, you&#8217;ll see that there are extensive comments. For each parameter in the BAMM control file, we&#8217;ve included a brief description on the line following the parameter. For example:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="n">modeltype</span> <span class="o">=</span> <span class="n">trait</span>
<span class="c"># Specify speciationextinction or trait analysis</span>
</pre></div>
</div>
<p>This tells us what parameter <cite>modeltype</cite> does. It specifies the type of analysis (here, a phenotypic evolution analysis). If we wanted to do a speciation-extinction analysis, we would have set <cite>modeltype = speciationextinction</cite>.</p>
<p>There are only a handful of parameters in the template file that you need to set explicitly in order to run BAMM. These are currently defined with the following symbol: <cite>%%%%</cite>. For example, you see the following immediately after <cite>modeltype</cite>:</p>
<div class="highlight-python"><pre>treefile = %%%%
# Location of phylogenetic tree to be analyzed</pre>
</div>
<p>This is where you specify the name of your phylogenetic tree. For example, <tt class="docutils literal"><span class="pre">treefile</span> <span class="pre">=</span> <span class="pre">mytree.tre</span></tt>. Since we are analyzing phenotypes, we also need to specify the location of the trait data, which we do here:</p>
<div class="highlight-python"><pre>traitfile = %%%%</pre>
</div>
<p>The trait file should consist of a 2 column text file, with species name followed by a tab, followed by the relevant trait value. Here is an <a class="reference download internal" href="_downloads/primates_logmass.txt"><tt class="xref download docutils literal"><span class="pre">example</span> <span class="pre">file</span></tt></a> of log-transformed primate body masses, and <a class="reference download internal" href="_downloads/primatetree.txt"><tt class="xref download docutils literal"><span class="pre">here</span></tt></a> is the corresponding Newick format tree. You should be able to plug these into the control file and get BAMM to run.</p>
<p>The other parameters we will force you to define explicitly have to do with output. This parameter block looks like this in the template:</p>
<div class="highlight-python"><pre>numberGenerations = %%%%

mcmcWriteFreq = %%%%

eventDataWriteFreq = %%%%

printFreq = %%%%</pre>
</div>
<p><tt class="docutils literal"><span class="pre">numberGenerations</span></tt> is the number of simulation steps you want in your MCMC analysis. <tt class="docutils literal"><span class="pre">printfreq</span></tt> is the frequency that BAMM will write some simple information to the screen so you can track the progress of the run. <tt class="docutils literal"><span class="pre">mcmcWriteFreq</span></tt> and <tt class="docutils literal"><span class="pre">eventDataWriteFreq</span></tt> tells BAMM how often to write the two basic types of output to file. BAMM generates two types of output. The first is a file containing basic attributes of the MCMC chain as you sample it at particular timepoints. This includes: the log-likelihood of the data under the current parameters, the number of diversification shifts in the current state, the log-prior density of the current parameters, and a moving-window average of the acceptance rate for the MCMC simulation. The second type of output is the <em>event data</em>. This is the real stuff of interest. It all parameters associated with the macroevolutionary rate regimes and is used for all the subsequent analyses of evolutionary rates.</p>
<p>You can set these parameters to whatever you want. However, please remember that you will be working with the <em>event data file</em> in R, which is a bit limited on memory. As a rough guide, we suggest choosing a value for <tt class="docutils literal"><span class="pre">eventDataWriteFreq</span></tt> that gives at least 1000 samples from the posterior, but we also don&#8217;t see much advantage to having more than 5000.</p>
<p>That&#8217;s all you need to know. For starters, you should try a simple run with settings like this:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="n">numberGenerations</span> <span class="o">=</span> <span class="mi">5000</span>
<span class="n">mcmcWriteFreq</span> <span class="o">=</span> <span class="mi">1000</span>
<span class="n">eventDataWriteFreq</span> <span class="o">=</span> <span class="mi">1000</span>
<span class="n">printFreq</span> <span class="o">=</span> <span class="mi">100</span>
</pre></div>
</div>
<p>You&#8217;ll want to increase all of these once you are sure the program is correctly loading your data etc, but it&#8217;s a good first check.</p>
</div>
<div class="section" id="bamm-output-brief">
<h2>3.4. BAMM output: brief<a class="headerlink" href="#bamm-output-brief" title="Permalink to this headline">¶</a></h2>
<p>BAMM generates multiple types of output files. These (usually) include:</p>
<ul class="simple">
<li>The <tt class="docutils literal"><span class="pre">runInfo</span></tt> file, containing a summary of your parameters/settings</li>
<li>An <tt class="docutils literal"><span class="pre">mcmc_out.txt</span></tt> or equivalent file, containing raw MCMC information useful in diagnosing convergence</li>
<li>An <tt class="docutils literal"><span class="pre">event_data.txt</span></tt> file or equivalent, containing all of evolutionary rate parameters and their topological mappings</li>
<li>A <tt class="docutils literal"><span class="pre">prior.txt</span></tt> file or equivalent, giving the prior expectation on the number of shift events (this is optional and can be turned off).</li>
</ul>
<p>In general, the post-BAMM workflow consists of:</p>
<ol class="arabic simple">
<li>Reading your MCMC file into R and testing whether your run appears to have converged. We advocate doing this using the <tt class="docutils literal"><span class="pre">coda</span></tt> package for R, which enables you to compute the <em>effective sample size</em> of your log-likelihoods and numbers of rate shifts sampled during the MCMC simulation.</li>
<li>Summarizing your posterior distribution on the number of rate shift events</li>
<li>Loading your <tt class="docutils literal"><span class="pre">event_data.txt</span></tt> file or equivalent into R using the <strong>BAMMtools</strong> package</li>
<li>Many potential downstream analyses, including summarizing mean evolutionary rates for clades, analyses of rate shift distributions, plotting model-averaged rate-through-time curves, and so on.</li>
</ol>
<p>A more detailed description of BAMMtools workflows for postprocessing BAMM output <a class="reference internal" href="postprocess.html#bammtools"><em>can be found here</em></a>.</p>
</div>
</div>


          </div>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="settingup.html" title="4. Setting Up BAMM"
             >next</a> |</li>
        <li class="right" >
          <a href="bammgraph.html" title="2. BAMM graph gallery"
             >previous</a> |</li>
<li><a href="index.html">Home</a>&nbsp;|</li>
<li><a href="download.html">Download</a>&nbsp;|</li>
<li><a href="documentation.html">Documentation</a></li>
 
      </ul>
    </div>
    <div class="footer">
        &copy; Copyright 2013 BAMM Team.
      Created using <a href="http://sphinx-doc.org/">Sphinx</a> 1.2b3.
    </div>
  </body>
</html>