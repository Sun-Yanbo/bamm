<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>14. Color ramps and phylorate plots &mdash; bamm 2.4.0 documentation</title>
    
    <link rel="stylesheet" href="_static/bamm.css" type="text/css" />
    <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    './',
        VERSION:     '2.4.0',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="_static/jquery.js"></script>
    <script type="text/javascript" src="_static/underscore.js"></script>
    <script type="text/javascript" src="_static/doctools.js"></script>
    <link rel="top" title="bamm 2.4.0 documentation" href="documentation.html" />
    <link rel="next" title="15. Frequently Asked Questions" href="faq.html" />
    <link rel="prev" title="8. The BAMM likelihood function" href="likelihoodmodel.html" /> 
  </head>
  <body role="document">
<div class="pageheader">
    <img src="_static/bamm-header.png" /img>
</div>

    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="faq.html" title="15. Frequently Asked Questions"
             accesskey="N">next</a></li>
        <li class="right" >
          <a href="likelihoodmodel.html" title="8. The BAMM likelihood function"
             accesskey="P">previous</a> |</li>
<li><a href="index.html">Home</a>&nbsp;|</li>
<li><a href="download.html">Download</a>&nbsp;|</li>
<li><a href="documentation.html">Documentation</a>&nbsp;|</li>
<li><a href="contact_us.html">Contact Us</a></li>
 
      </ul>
    </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
  <h3><a href="documentation.html">Table Of Contents</a></h3>
  <ul>
<li><a class="reference internal" href="#">14. Color ramps and phylorate plots</a><ul>
<li><a class="reference internal" href="#what-options-are-available">14.1. What options are available?</a></li>
<li><a class="reference internal" href="#a-note-of-caution">14.2. A note of caution</a></li>
<li><a class="reference internal" href="#what-should-you-do">14.3. What should you do?</a></li>
<li><a class="reference internal" href="#how-do-i-plot-these-histograms">14.4. How do I plot these histograms?</a></li>
</ul>
</li>
</ul>

  <h4>Previous topic</h4>
  <p class="topless"><a href="likelihoodmodel.html"
                        title="previous chapter">8. The BAMM likelihood function</a></p>
  <h4>Next topic</h4>
  <p class="topless"><a href="faq.html"
                        title="next chapter">15. Frequently Asked Questions</a></p>
  <div role="note" aria-label="source link">
    <h3>This Page</h3>
    <ul class="this-page-menu">
      <li><a href="_sources/colorbreaks.txt"
            rel="nofollow">Show Source</a></li>
    </ul>
   </div>
<div id="searchbox" style="display: none" role="search">
  <h3>Quick search</h3>
    <form class="search" action="search.html" method="get">
      <input type="text" name="q" />
      <input type="submit" value="Go" />
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
    <p class="searchtip" style="font-size: 90%">
    Enter search terms or a module, class or function name.
    </p>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <div class="section" id="color-ramps-and-phylorate-plots">
<span id="colorbreaks"></span><h1>14. Color ramps and phylorate plots<a class="headerlink" href="#color-ramps-and-phylorate-plots" title="Permalink to this headline">¶</a></h1>
<p>When plotting instantaneous rates along the branches of a phylogeny with <code class="docutils literal"><span class="pre">plot.bammdata</span></code> (as well as with any other BAMMtools function that creates a phylorate plot), it is important to keep in mind how rates are mapped to colors, and what this can mean for interpretation.</p>
<div class="section" id="what-options-are-available">
<h2>14.1. What options are available?<a class="headerlink" href="#what-options-are-available" title="Permalink to this headline">¶</a></h2>
<p><code class="docutils literal"><span class="pre">plot.bammdata</span></code> has a number of options available to bin rates into particular colors (the breaksmethod options). Depending on the dataset, these different options can lead to drastically different phylorate plots. On top of these breaksmethods, there are additional data transformation/truncation options that will modify the behavior of the breaksmethods.</p>
<p>The breaksmethod options are:</p>
<ol class="arabic">
<li><p class="first"><strong>linear method</strong>:</p>
<blockquote>
<div><p>Rates across the phylogeny are divided into equal-width bins, and a color from the defined color ramp is associated with each of these bins. The range of this linear color mapping is defined by the fastest and the slowest rates across the tree, regardless of the frequency of these rates. This method can lead to misleading interpretations if the fastest or slowest rates are only represented by a small fraction of the tree, giving the appearance of a lack of rate heterogeneity.</p>
</div></blockquote>
</li>
<li><p class="first"><strong>quantile method</strong>:</p>
<blockquote>
<div><p>Rates are divided into bins, such that each bin has the same density of rates. This method can potentially be misleading in that it might over-emphasize minor rate variation.</p>
</div></blockquote>
</li>
<li><p class="first"><strong>Jenks natural breaks method</strong>:</p>
<blockquote>
<div><p>Rates are divided into bins such that the variance within bins is minimized, while the variance between bins is maximized.</p>
</div></blockquote>
</li>
</ol>
<p>Additional options include:</p>
<ol class="upperalpha">
<li><p class="first"><strong>log transformation</strong>:</p>
<blockquote>
<div><p>For any of these breaksmethods, the rates can first be log-transformed, by setting <code class="docutils literal"><span class="pre">logcolor</span> <span class="pre">=</span> <span class="pre">TRUE</span></code>.</p>
</div></blockquote>
</li>
<li><p class="first"><strong>color.interval</strong>:</p>
<blockquote>
<div><p>The minimum and maximum values of rate values can be manually provided. This has the effect of setting anything greater than the new maximum to the maximum color value, and anything less than the new minimum to the minimum color value. Values across this color interval are then mapped according to the specified breaksmethod.</p>
</div></blockquote>
</li>
</ol>
<p>It is important to understand that while these different color mapping methods can lead to different phylorate plots, <strong>the underlying raw data remains the same</strong> (or log-transformed) and any downstream quantitative analyses of rates are completely unaffected by the breaks method chosen.</p>
<p>We illustrate these differences with an example. This is a BAMM analysis of primate body mass (Vos and Moors 2008). For each breaks method, we generated a histogram showing the frequency of rate values in the dataset, colored according to the selected breaks method. Vertical bars show how the rates have been binned.</p>
<p>From these histograms, it is clear that there are segments of the phylogeny with much higher rates than for the rest of the phylogeny, but these segments encompass only a very small subset (the histogram has a long tail).</p>
<div class="figure align-center" id="breakstest">
<a class="reference internal image-reference" href="_images/breaksTest.png"><img alt="_images/breaksTest.png" src="_images/breaksTest.png" style="width: 700px;" /></a>
</div>
<p>Now we show how these different methods produce different phylorate figures. Due to the long tail of the distribution of rates, the linear breaks method does a poor job of showing rate variation across the phylogeny.</p>
<div class="figure align-center" id="breakstesttrees">
<a class="reference internal image-reference" href="_images/breaksTestTrees.png"><img alt="_images/breaksTestTrees.png" src="_images/breaksTestTrees.png" style="width: 700px;" /></a>
</div>
</div>
<div class="section" id="a-note-of-caution">
<h2>14.2. A note of caution<a class="headerlink" href="#a-note-of-caution" title="Permalink to this headline">¶</a></h2>
<p><strong>WARNING: You cannot interpret colors alone as evidence of rate heterogeneity.</strong></p>
<p>As an example, if you have a bamm analysis where there are no core shifts, i.e., there is no real rate heterogeneity, stochastic noise in the BAMM posterior distribution can be emphasized through the selection of particular color options, such as the quantile colorbreaks method. As these methods define colors on a relative, and not on an absolute scale, it is easy to create a deceptive phylorate plot. This is a common issue in real datasets.</p>
</div>
<div class="section" id="what-should-you-do">
<h2>14.3. What should you do?<a class="headerlink" href="#what-should-you-do" title="Permalink to this headline">¶</a></h2>
<p>Although, we have provided a number of options to best convey rate variation across a phylogeny, it is now possible to generate a large number of different phylorate plots and it is important to not misuse these options. <strong>Colors can be misleading, and there is no general guideline for displaying rate heterogeneity.</strong> We have included multiple options in BAMM to allow you, the user, to determine what works best for your data. If 98% of the lineages in your phylogeny have a slow rate of speciation and 2% have a very fast rate, a linear mapping may work best, because it will effectively show two colors. If you have intermediate rates, or a broad range of rate classes, then the quantile or jenks methods may work. We refrain from providing strong guidelines here and merely equip you with the tools to explore the most effective presentation of your data.</p>
<p>One starting point could be to use the locations of core shifts as a guide for what <strong>should</strong> be emphasized with the colors. In the above figure, the linear method fails to highlight existing rate shifts, although log-transformation of the rates, or use of <code class="docutils literal"><span class="pre">color.interval</span></code> alleviates the problem. The quantile method is exaggerating the existing rate variation in this case. The jenks method appears to do a good job. We suggest that <code class="docutils literal"><span class="pre">color.interval</span></code> only be employed when necessary, in combination with the <code class="docutils literal"><span class="pre">linear</span></code> breaksmethod, as the misuse of this option can lead to misrepresentation of rates on a phylogeny.</p>
</div>
<div class="section" id="how-do-i-plot-these-histograms">
<h2>14.4. How do I plot these histograms?<a class="headerlink" href="#how-do-i-plot-these-histograms" title="Permalink to this headline">¶</a></h2>
<p>For those interested in exploring rate heterogeneity in the form of a histogram, we demonstrate how the above histograms were created:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="n">library</span><span class="p">(</span><span class="n">BAMMtools</span><span class="p">)</span>
<span class="c">#load data</span>
<span class="n">data</span><span class="p">(</span><span class="n">primates</span><span class="p">,</span> <span class="n">events</span><span class="o">.</span><span class="n">primates</span><span class="p">)</span>
<span class="n">ed</span> <span class="o">&lt;-</span> <span class="n">getEventData</span><span class="p">(</span><span class="n">primates</span><span class="p">,</span> <span class="n">events</span><span class="o">.</span><span class="n">primates</span><span class="p">,</span> <span class="n">burnin</span><span class="o">=</span><span class="mf">0.25</span><span class="p">,</span> <span class="nb">type</span> <span class="o">=</span> <span class="s">&#39;trait&#39;</span><span class="p">)</span>

<span class="c">#create phylorate plot to generate output</span>
<span class="n">q</span> <span class="o">&lt;-</span> <span class="n">plot</span><span class="o">.</span><span class="n">bammdata</span><span class="p">(</span><span class="n">ed</span><span class="p">,</span> <span class="n">breaksmethod</span><span class="o">=</span><span class="s">&#39;jenks&#39;</span><span class="p">)</span>

<span class="n">ratesHistogram</span><span class="p">(</span><span class="n">q</span><span class="p">,</span> <span class="n">plotBrks</span> <span class="o">=</span> <span class="n">TRUE</span><span class="p">,</span> <span class="n">xlab</span> <span class="o">=</span> <span class="s">&#39;trait rates&#39;</span><span class="p">)</span>

<span class="n">title</span><span class="p">(</span><span class="n">main</span><span class="o">=</span><span class="s">&#39;jenks&#39;</span><span class="p">,</span> <span class="n">cex</span><span class="o">.</span><span class="n">main</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>


          </div>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="faq.html" title="15. Frequently Asked Questions"
             >next</a></li>
        <li class="right" >
          <a href="likelihoodmodel.html" title="8. The BAMM likelihood function"
             >previous</a> |</li>
<li><a href="index.html">Home</a>&nbsp;|</li>
<li><a href="download.html">Download</a>&nbsp;|</li>
<li><a href="documentation.html">Documentation</a>&nbsp;|</li>
<li><a href="contact_us.html">Contact Us</a></li>
 
      </ul>
    </div>

    <div class="footer" role="contentinfo">
        &copy; Copyright 2015 BAMM Team.
      Created using <a href="http://sphinx-doc.org/">Sphinx</a> 1.3b3+.
    </div>
<script>
(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
})(window,document,'script','//www.google-analytics.com/analytics.js','ga');
ga('create', 'UA-49579863-1', 'bamm-project.org');
ga('send', 'pageview');
</script>

  </body>
</html>